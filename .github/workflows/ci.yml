# .github/workflows/ci.yml
# ---------------------------------------------
# Continuous Integration pipeline
#
# WHY THIS EXISTS:
# - Automatically validate every pull request
# - Prevent broken code from reaching main
# - Ensure the Docker image can be built
#
# WHAT THIS IS NOT:
# - This does NOT deploy anything
# - Deployment comes in the CD phase

# CI pipeline:
# Runs on pull requests to main.
# Installs dependencies, runs tests, and builds the Docker image.
# Ensures only deployable, validated code is merged.
# ---------------------------------------------
# on:
#   pull_request:
#   push:
#     branches: [ "main" ]
# as of right now only runs on prs as running on every push would it insane, but this is how it is done
name: CI

on:
  pull_request:
    branches: ["main"]

jobs:
  test-and-build:
    name: Test and Build
    runs-on: ubuntu-latest

    steps:
      # 1. Get the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3. Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. Run tests (placeholder for now)
      - name: Run tests
        run: |
          echo "No tests yet â€” placeholder"
          # pytest will go here in the next phase

      # 5. Build Docker image
      - name: Build Docker image
        run: |
          docker build -t pipeline-dashboard .
